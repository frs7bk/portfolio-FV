# إرشادات هامة للنشر على Render وحل المشاكل

## حل مشكلة خطأ 500 في لوحة التحكم

تم تحسين التطبيق لمعالجة المشكلات الشائعة على منصة Render. إذا كنت تواجه خطأ 500 عند الوصول إلى لوحة التحكم، يجب التحقق من النقاط التالية:

### 1. التأكد من صلاحيات المستخدم

قد تكون المشكلة بسبب دور المستخدم "admin" المضبوط كـ "visitor" بدلاً من "admin". لحل هذه المشكلة:

1. قم بالوصول إلى قاعدة البيانات الخاصة بك على Neon.tech أو أي مزود آخر
2. قم بتنفيذ الاستعلام التالي:

```sql
UPDATE "user" SET "role" = 'admin' WHERE "username" = 'admin';
```

### 2. استخدام صفحة التشخيص

تمت إضافة صفحة تشخيص جديدة تساعدك على تحديد المشاكل المحتملة:

1. قم بتسجيل الدخول كمستخدم admin
2. انتقل إلى `/system-diagnostic`
3. اتبع التوصيات المقدمة في الصفحة لإصلاح المشاكل

### 3. التأكد من متغيرات البيئة

تأكد من وجود متغيرات البيئة التالية في إعدادات Render:

- `DATABASE_URL`: رابط الاتصال بقاعدة البيانات PostgreSQL
- `FLASK_SECRET_KEY`: مفتاح سري للتطبيق
- `SESSION_SECRET`: مفتاح سري للجلسات

### 4. تحسينات في معالجة الأخطاء

تم إجراء التحسينات التالية لمعالجة المشاكل على Render:

1. تحسين تسجيل الأخطاء للمساعدة في تشخيص المشاكل
2. تحسين الاتصال بقاعدة البيانات وإضافة آليات إعادة المحاولة
3. تحسين إدارة المجلدات اللازمة للتطبيق
4. إضافة صفحة تشخيص لتحديد المشاكل المحتملة

### 5. إعداد البيئة أثناء النشر

تأكد من أن أمر النشر في Render يتضمن:

```
pip install -r render-requirements.txt && python render_setup.py
```

وأن أمر التشغيل هو:

```
gunicorn --bind 0.0.0.0:$PORT --workers 2 main:app
```

## ملفات جديدة في هذا الإصدار

1. `diagnostics.py`: أداة لتشخيص مشاكل التطبيق والاتصال بقاعدة البيانات
2. `templates/diagnostic.html`: صفحة عرض نتائج التشخيص
3. تحسينات في `render_setup.py` لإدارة أفضل لإعداد البيئة
4. تحسينات في `test_database_connection.py` لاختبار أفضل للاتصال بقاعدة البيانات
5. معالجة أخطاء محسنة في `app.py`

## روابط مفيدة في التطبيق

- واجهة تسجيل الدخول: `/admin/login`
- لوحة التحكم الرئيسية: `/admin/dashboard`
- صفحة التشخيص: `/system-diagnostic`
- إدارة معرض الأعمال: `/admin/portfolio`
- لوحة الإحصائيات: `/analytics/dashboard`